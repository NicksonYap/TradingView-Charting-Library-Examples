(window.webpackJsonp=window.webpackJsonp||[]).push([["dome-panel"],{"/MDk":function(e,t,i){},"07Ph":function(e,t,i){"use strict";var s,n,o,r,a;Object.defineProperty(t,"__esModule",{value:!0}),t.DomeData=void 0,s=function(){function e(e,t){var i,s;for(i=0;i<t.length;i++)(s=t[i]).enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),n=i("F/Al"),o=i("OekH"),r=i("hY0g"),a=3,t.DomeData=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._handlers=t||{},this._showPricesWithZeroVolume=i,this.autoCenterRequired=new r(!1),this.height=0,this.topIndex=NaN,this._$container=null,this._$listContainer=null,this._symbolData=null,this._lastPriceIndex=NaN,this._viewAllocated=null,this._viewPool=null,this._invalidatedAsk={},this._invalidatedBid={},this._invalidatedPriceHighlight={},this._invalidatedMax=!1,this._invalidatedOrders={},this._showPricesWithZeroVolume.subscribe(this.scheduleRepaint.bind(this)),this.reset()}return s(e,[{key:"reset",value:function(){this.topIndex=NaN,this._symbolData=null,this._lastPriceIndex=NaN,this.resetData(),this.resetView(),this.resetOrders(),this.resetOrderGhost(),this.resetPosition(),this.autoCenterRequired.setValue(!1)}},{key:"resetData",value:function(){if(this._bids={},this._asks={},this._recalcMaxVolume(),this._recalcBestWorstBid(),this._recalcBestWorstAsk(),this._viewAllocated)for(var e in this._viewAllocated)this._invalidatedAsk[e]=!0,this._invalidatedBid[e]=!0;$(this._$offscreenArrowHigher).addClass("js-hidden"),$(this._$offscreenArrowLower).addClass("js-hidden"),this._offscreenPriceHigher=!1,this._offscreenPriceLower=!1,this.scheduleRepaint()}},{key:"resetOrders",value:function(){if(this._orders)for(var e in this._orders)this._invalidatedOrders[e]=!0;this._orders={},this.scheduleRepaint()}},{key:"resetPosition",value:function(){this._invalidatedPriceHighlight[this._positionIndex]=!0,this._positionIndex=NaN,this._positionQty=0,this.scheduleRepaint()}},{key:"resetView",value:function(){if(this._viewAllocated&&this._viewPool)for(var e in this._viewAllocated)this._viewAllocated[e].$element.detach(),this._viewPool.free(this._viewAllocated[e]),delete this._viewAllocated[e];this._$listContainer&&this._$listContainer.empty(),this.setDragShield(!1),this.scheduleRepaint()}},{key:"setSymbolInfo",value:function(e){var t=e.minTick,i=e.priceFormatter,s=e.volumeFormatter,n=e.quantityFormatter;this._symbolData={minTick:t,priceFormatter:i,volumeFormatter:s,quantityFormatter:n}}},{key:"setContainer",value:function(e){if(this._$container!==e){this._$container&&(this.resetView(),this._$container.empty()),this._$container=e;var t=e.prop("ownerDocument");this._containerWnd=t&&t.defaultView,this._viewPool=new n.DomeRowViewPool(e,this._handlers),this._viewAllocated={},this._$listContainer=$("<div>",e).addClass("tv-dome-widget-main__anchor").appendTo(e),
this._$offscreenArrowHigher=$("<span>",e).addClass("tv-dome-widget-main__offscreen-arrow tv-dome-widget-main__offscreen-arrow--higher js-hidden").html(i("pG/X")).appendTo(e),this._$offscreenArrowLower=$("<span>",e).addClass("tv-dome-widget-main__offscreen-arrow tv-dome-widget-main__offscreen-arrow--lower js-hidden").html(i("zIOD")).appendTo(e),this._$dragShield=$("<div>",e).addClass("tv-dome-widget-main__drag-shield js-hidden").appendTo(e),this._repaintScheduled=!1,this.scheduleRepaint()}}},{key:"setHeight",value:function(e){e!==this.height&&(this.height=e,this.checkAutoCenter(),this.scheduleRepaint())}},{key:"shiftTopIndexRelativeToIndex",value:function(e,t){var i=this.correctIndex(e,t);this._setTopIndex(i)}},{key:"handlerKey",value:function(e){var t,i,s,n,o=this.topIndex;if(this._canIndexBeDisplayed(o)||(o=this.correctIndex(o,-1)),t=this.correctIndex(o,1-this.height),isFinite(t))for(i=this._viewAllocated,s=t;s<=o;s++)this._canIndexBeDisplayed(s)&&(n=i[s])&&n.handlerKey(e)}},{key:"_setTopIndex",value:function(e){e!==this.topIndex&&(this.topIndex=e,this.checkAutoCenter(),this.scheduleRepaint())}},{key:"_canIndexBeDisplayed",value:function(e){var t,i,s,n,o,r;return!!this._showPricesWithZeroVolume.value()||(t=e===this._lastPriceIndex,i=e===this._positionIndex,s=void 0!==this._bids[e]||void 0!==this._asks[e],n=e<=this._worstBidIndex||this._worstAskIndex<=e,o=this._orders[e]||[],r=this._orderGhost&&this._orderGhost.index===e,i||t||r||n||s||0!==o.length)}},{key:"correctIndex",value:function(e,t){var i,s,n;if(!isFinite(e))return e;if(this._showPricesWithZeroVolume.value())return e+t;for(i=t>0?1:-1,s=0,n=1,t=Math.abs(t);s<t;++n)this._canIndexBeDisplayed(e+i*n)&&(s+=1);return e+i*(n-1)}},{key:"_getGapMiddleIndex",value:function(){var e=this._bestAskIndex,t=this._bestBidIndex;return isFinite(e)||(e=t),isFinite(t)||(t=e),(t+e)/2}},{key:"_autoCenterTargetTopIndex",value:function(){var e=NaN;return e=isFinite(this._lastPriceIndex)?this._lastPriceIndex:this._getGapMiddleIndex(),this.correctIndex(Math.floor(e),Math.floor(this.height/2))}},{key:"centerOnLast",value:function(){this.autoCenterRequired.setValue(!1);var e=this._autoCenterTargetTopIndex();isFinite(e)&&this._setTopIndex(e)}},{key:"guessOrderType",value:function(e,t){var i,s,n=this.priceToIndex(e);if(isFinite(e)&&(t===o.SIDE.BUY||t===o.SIDE.SELL))return i=this._bestAskIndex,s=this._bestBidIndex,isFinite(i)||(i=s+1),isFinite(s)||(s=i-1),isFinite(i)||isFinite(s)||(i=s=this._lastPriceIndex),t===o.SIDE.BUY?n<i?o.ORDERTYPE.LIMIT:o.ORDERTYPE.STOP:n>s?o.ORDERTYPE.LIMIT:o.ORDERTYPE.STOP}},{key:"indexToPrice",value:function(e){return e*this._symbolData.minTick}},{key:"priceToIndex",value:function(e){return this._symbolData?Math.round(e/this._symbolData.minTick):void 0}},{key:"_recalcMaxVolume",value:function(){var e,t,i=0;for(e in this._asks)i=Math.max(this._asks[e],i);for(t in this._bids)i=Math.max(this._bids[t],i);i!==this._currentVolumeMax&&(this._currentVolumeMax=i,this._invalidatedMax=!0)}},{key:"_recalcBestWorstBid",value:function(){var e,t=-1/0,i=1/0
;for(e in this._bids)+e>t&&(t=+e),+e<i&&(i=+e);this._bestBidIndex=t,this._worstBidIndex=i}},{key:"_recalcBestWorstAsk",value:function(){var e,t=1/0,i=-1/0;for(e in this._asks)+e<t&&(t=+e),+e>i&&(i=+e);this._bestAskIndex=t,this._worstAskIndex=i}},{key:"updateData",value:function(e){var t,i,s,n,o,r,a,l=!1;if(e.snapshot&&(t=0===Object.keys(this._asks).length&&0===Object.keys(this._bids).length,l=!this._showPricesWithZeroVolume.value()&&t,this.resetData()),e.bids){for(i=0;i<e.bids.length;i++)s=this.priceToIndex(e.bids[i].price),n=e.bids[i].volume,(this._bids[s]||0)!==n&&(n>0?this._bids[s]=n:delete this._bids[s],this._invalidatedBid[s]=!0);this._recalcBestWorstBid()}if(e.asks){for(o=0;o<e.asks.length;o++)r=this.priceToIndex(e.asks[o].price),a=e.asks[o].volume,(this._asks[r]||0)!==a&&(a>0?this._asks[r]=a:delete this._asks[r],this._invalidatedAsk[r]=!0);this._recalcBestWorstAsk()}this._recalcMaxVolume(),l?this.centerOnLast():this.checkAutoCenter(),this.scheduleRepaint()}},{key:"updateOrders",value:function(e){var t,i,s,n;for(this.resetOrders(),t=0;t<e.length;t++)null!=(i=e[t]).stopPrice&&(s=this.priceToIndex(i.stopPrice),this._orders[s]||(this._orders[s]=[]),this._orders[s].push({order:i,pricePropertyName:"stopPrice"}),this._invalidatedOrders[s]=!0),null!=i.limitPrice&&(n=this.priceToIndex(i.limitPrice),this._orders[n]||(this._orders[n]=[]),this._orders[n].push({order:i,pricePropertyName:"limitPrice"}),this._invalidatedOrders[n]=!0);this.scheduleRepaint()}},{key:"updateLast",value:function(e){var t=this.priceToIndex(e);t!==this._lastPriceIndex&&(this._invalidatedPriceHighlight[this._lastPriceIndex]=!0,this._invalidatedPriceHighlight[t]=!0,this._lastPriceIndex=t,this.checkAutoCenter(),this.scheduleRepaint())}},{key:"updatePosition",value:function(e){var t,i;e&&e.qty?(t=this.priceToIndex(e.avgPrice),i=Math.abs(e.qty)*(e.side===o.SIDE.BUY?1:-1),this._positionIndex===t&&this._positionQty===i||(this._invalidatedPriceHighlight[this._positionIndex]=!0,this._invalidatedPriceHighlight[t]=!0,this._positionIndex=t,this._positionQty=i,this.scheduleRepaint())):this.resetPosition()}},{key:"resetOrderGhost",value:function(){this._orderGhost&&(this._invalidatedOrders[this._orderGhost.index]=!0,this._invalidatedOrders[this._orderGhost.originIndex]=!0,this._orderGhost=null,this.scheduleRepaint())}},{key:"setOrderGhost",value:function(e){var t,i=e.order,s=e.pricePropertyName,n=e.price;this.resetOrderGhost(),t=this.priceToIndex(n),isFinite(t)&&(this._orderGhost={ghost:!0,order:i,pricePropertyName:s,index:t,originIndex:this.priceToIndex(i[s])},this._invalidatedOrders[t]=!0,this.scheduleRepaint())}},{key:"setDragShield",value:function(e){this._$dragShield&&this._$dragShield.toggleClass("js-hidden",!e)}},{key:"scheduleRepaint",value:function(){var e=this;this._repaintScheduled||this._symbolData&&(this._containerWnd&&this._containerWnd.requestAnimationFrame?this._containerWnd.requestAnimationFrame(function(){return e.repaint()}):window.setTimeout(function(){return e.repaint()},0),this._repaintScheduled=!0)}},{key:"formatVolume",value:function(e){
return this._symbolData.volumeFormatter.format(e).slice(0,8)}},{key:"repaint",value:function(){var e,t,i,s,n,r,a,l,d,u,c,h,_,p,v,m,f,g,y,b,k,w,T,P,C,S,x;if(this._repaintScheduled=!1,this._$listContainer&&this._symbolData&&(e=this.topIndex,this._canIndexBeDisplayed(e)||(e=this.correctIndex(e,-1)),t=this.correctIndex(e,1-this.height),isFinite(t))){for(i=this._viewAllocated,n=(s=Object.keys(this._viewAllocated)).length;n--;)((a=+(r=s[n]))>e||a<t||!this._canIndexBeDisplayed(a))&&(i[r].$element.detach(),this._viewPool.free(i[r]),delete i[r]);for(l=t;l<=e;l++)if(this._canIndexBeDisplayed(l)){if(d=!1,(u=i[l])||(u=this._viewPool.allocate(),i[l]=u,d=!0),c=this._orderGhost,d&&(h=this.indexToPrice(l),u.updateIndex(l),u.updatePrice(h),u.updatePriceText(this._symbolData.priceFormatter.format(h))),(d||this._invalidatedAsk[l])&&(this._asks[l]&&this._asks[l]!==1/0?u.updateAskVolume(this.formatVolume(this._asks[l])):u.updateAskVolume(""),u.updateAskLabels(l<this._bestAskIndex)),(d||this._invalidatedBid[l])&&(this._bids[l]&&this._bids[l]!==1/0?u.updateBidVolume(this.formatVolume(this._bids[l])):u.updateBidVolume(""),u.setHigherThanBid(l>this._bestBidIndex)),(d||this._invalidatedAsk[l]||this._invalidatedMax)&&u.updateAskMeter(this._asks[l]===1/0?100:this._asks[l]/this._currentVolumeMax||0),(d||this._invalidatedBid[l]||this._invalidatedMax)&&u.updateBidMeter(this._bids[l]===1/0?100:this._bids[l]/this._currentVolumeMax||0),(d||this._invalidatedPriceHighlight[l])&&(_=l===this._lastPriceIndex,p=l===this._positionIndex?this._positionQty:0,u.updatePriceHighlight(_,p)),d||this._invalidatedOrders[l]){for(v=this._orders[l]||[],m=void 0,f=void 0,this._orderGhost&&(c.index===l&&(c.originIndex!==l?v=v.concat(c):f=c.order.id),c.index!==l&&c.originIndex!==l||(m=c.order.side)),g=0;g<v.length;g++){switch(b=(y=v[g]).order,y.inactive=b.status!==o.ORDERSTATUS.WORKING||b.type===o.ORDERTYPE.STOPLIMIT&&"limitPrice"===y.pricePropertyName,b.type){case o.ORDERTYPE.MARKET:y.typeText=$.t("Market"),y.type="market";break;case o.ORDERTYPE.LIMIT:y.typeText=b.parentId?$.t("TakeProfit"):$.t("Limit"),y.type="limit";break;case o.ORDERTYPE.STOP:y.typeText=b.parentId?$.t("StopLoss"):$.t("Stop",{context:"order"}),y.type="stop";break;case o.ORDERTYPE.STOPLIMIT:y.typeText=$.t("StopLimit"),y.type="stoplimit";break;default:y.typeText=""}y.qty=this._symbolData.quantityFormatter.format(b.qty),y.buy=b.side===o.SIDE.BUY,y.noCollapse=b.side===m,y.highlighted=null!=f&&b.id===f&&c.pricePropertyName===y.pricePropertyName}u.hideLabels(),u.updateOrders(v)}d&&(i[k=this.correctIndex(l,-1)]?u.$element.insertBefore(i[k].$element):u.$element.appendTo(this._$listContainer))}for(P in isFinite(this._lastPriceIndex)&&(w=this._lastPriceIndex>e,T=this._lastPriceIndex<t,w!==this._offscreenPriceHigher&&(this._offscreenPriceHigher=w,this._$offscreenArrowHigher.toggleClass("js-hidden",!w)),T!==this._offscreenPriceLower&&(this._offscreenPriceLower=T,this._$offscreenArrowLower.toggleClass("js-hidden",!T))),this._invalidatedMax=!1,this._invalidatedBid)delete this._invalidatedBid[P]
;for(C in this._invalidatedAsk)delete this._invalidatedAsk[C];for(S in this._invalidatedPriceHighlight)delete this._invalidatedPriceHighlight[S];for(x in this._invalidatedOrders)delete this._invalidatedOrders[x]}}},{key:"checkAutoCenter",value:function(){var e,t,i,s;isFinite(this.topIndex)||this.centerOnLast(),e=this.topIndex,t=this.correctIndex(this.topIndex,1-this.height),i=void 0,i=isFinite(this._bestBidIndex)?this._bestBidIndex:isFinite(this._bestAskIndex)?this._bestAskIndex:NaN,s=!1,((isFinite(this._bestAskIndex)?this._bestAskIndex:isFinite(this._bestBidIndex)?this._bestBidIndex:NaN)+a>e||i-a<t)&&this.topIndex!==this._autoCenterTargetTopIndex()&&(s=!0),this.autoCenterRequired.setValue(s)}}]),e}()},"4eeX":function(e,t,i){},"77R2":function(e,t,i){},"7R8i":function(e,t,i){},BB8A:function(e,t,i){},"F/Al":function(e,t,i){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n,o,r,a,l,d,u;Object.defineProperty(t,"__esModule",{value:!0}),t.DomeRowViewPool=void 0,n=function(){function e(e,t){var i,s;for(i=0;i<t.length;i++)(s=t[i]).enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),o=i("/3z9"),r=i("OekH"),i("/MDk"),a={limitOrder:window.t("Limit"),stopOrder:window.t("Stop")},t.DomeRowViewPool=function(){function e(t,i){s(this,e),this._pool=[];var n=t.get(0);n.nodeType===Node.DOCUMENT_NODE?this._document=n:this._document=n.ownerDocument,this._handlers=i||{},this._ordersPool=new d(t,this._handlers),this._useCssTransform="transform"in this._document.createElement("span").style}return n(e,[{key:"allocate",value:function(){return this._pool.length?this._pool.pop():new l(this._document,this._ordersPool,this._handlers,this._useCssTransform)}},{key:"free",value:function(e){e.destroy(),this._pool.push(e)}}]),e}(),l=function(){function e(t,i,n,l){var d,u,c,h,_,p,v,m,f,g,y,b,k,w,T,P=this;s(this,e),this._useCssTransform=l,this._ordersPool=i,this._handlers=n,this._allocatedOrderViews=[],(d=t.createElement("div")).setAttribute("class","tv-dome-widget-main__row"),(u=t.createElement("span")).setAttribute("class","tv-dome-widget-main__value tv-dome-widget-main__value--price"),(c=t.createElement("span")).setAttribute("class","tv-dome-widget-main__value tv-dome-widget-main__value--sell"),(h=t.createElement("span")).setAttribute("class","tv-dome-widget-main__value tv-dome-widget-main__value--buy"),(_=t.createElement("span")).setAttribute("class","tv-dome-widget-main__meter tv-dome-widget-main__meter--sell"),(p=t.createElement("span")).setAttribute("class","tv-dome-widget-main__meter tv-dome-widget-main__meter--buy"),(v=t.createElement("span")).setAttribute("class","tv-dome-widget-main__value-readout"),(m=t.createElement("span")).setAttribute("class","tv-dome-widget-main__value-readout"),f=t.createTextNode(""),g=t.createTextNode(""),y=t.createTextNode(""),this._useCssTransform&&(_.style.width=p.style.width="100%",_.style.transform=p.style.transform="scale(0, 1)"),
(b=t.createElement("span")).setAttribute("class","tv-dome-widget-main__value tv-dome-widget-main__value--orders-buy"),(k=t.createElement("span")).textContent=a.limitOrder,k.setAttribute("class","tv-dome-widget-main__label"),b.appendChild(k),(w=t.createElement("span")).setAttribute("class","tv-dome-widget-main__value tv-dome-widget-main__value--orders-sell"),(T=t.createElement("span")).textContent=a.limitOrder,T.setAttribute("class","tv-dome-widget-main__label"),w.appendChild(T),d.appendChild(c),d.appendChild(h),d.appendChild(u),d.appendChild(b),d.appendChild(w),u.appendChild(y),c.appendChild(_),h.appendChild(p),c.appendChild(v),h.appendChild(m),v.appendChild(f),m.appendChild(g),this._priceCell=u,this._priceText=y,this._askText=f,this._bidText=g,this._askMeter=_,this._bidMeter=p,this._ordersBuy=b,this._ordersSell=w,this._orderBuyLabel=k,this._orderSellLabel=T,this._isHigherThanBestBid=!1,this._isLowerThanBestAsk=!1,this._orderType=r.ORDERTYPE.LIMIT,n&&n.bidAskClick&&(c.addEventListener("click",function(e){return P._handlerCellClick(r.SIDE.SELL,e)},!1),h.addEventListener("click",function(e){return P._handlerCellClick(r.SIDE.BUY,e)},!1)),n&&n.bidAskContextMenu&&(c.addEventListener("contextmenu",function(e){n.bidAskContextMenu.call(null,e,{price:P._price,side:r.SIDE.SELL})},!1),h.addEventListener("contextmenu",function(e){n.bidAskContextMenu.call(null,e,{price:P._price,side:r.SIDE.BUY})},!1)),c.addEventListener("mouseover",function(e){T.textContent=(0,o.modifiersFromEvent)(e)===o.Modifiers.Mod?a.stopOrder:a.limitOrder,T.style.visibility="visible"},!1),c.addEventListener("mouseout",function(){T.style.visibility="hidden"},!1),h.addEventListener("mouseover",function(e){k.textContent=(0,o.modifiersFromEvent)(e)===o.Modifiers.Mod?a.stopOrder:a.limitOrder,k.style.visibility="visible"},!1),h.addEventListener("mouseout",function(){k.style.visibility="hidden"},!1),this.$element=$(d)}return n(e,[{key:"_handlerCellClick",value:function(e,t){var i=(0,o.modifiersFromEvent)(t);[o.Modifiers.None,o.Modifiers.Mod].includes(i)&&this._handlers.bidAskClick.call(null,t,{price:this._price,side:e,type:i===o.Modifiers.Mod?r.ORDERTYPE.STOP:r.ORDERTYPE.LIMIT})}},{key:"_updateLabelColor",value:function(e,t){var i,s=e.classList;s?s.toggle("tv-dome-widget-main__label--active",t):(i="tv-dome-widget-main__label",t&&(i+=" tv-dome-widget-main__label--active"),e.setAttribute("class",i))}},{key:"_isActive",value:function(e){var t=this._orderType===r.ORDERTYPE.STOP;return t&&!e||!t&&e}},{key:"updatePriceText",value:function(e){this._priceText.nodeValue=e}},{key:"updateBidVolume",value:function(e){this._bidText.nodeValue=e||""}},{key:"updateAskVolume",value:function(e){this._askText.nodeValue=e||""}},{key:"updateBidMeter",value:function(e){var t=Math.min(Math.max(e,0),1)||0;this._useCssTransform?this._bidMeter.style.transform="scale("+t+", 1)":this._bidMeter.style.width=100*t+"%"}},{key:"updateAskMeter",value:function(e){var t=Math.min(Math.max(e,0),1)||0
;this._useCssTransform?this._askMeter.style.transform="scale("+t+", 1)":this._askMeter.style.width=100*t+"%"}},{key:"updatePriceHighlight",value:function(e,t){var i,s=this._priceCell.classList;s?(s.toggle("tv-dome-widget-main__value--highlighted",e),s.toggle("tv-dome-widget-main__value--long-position",t>0),s.toggle("tv-dome-widget-main__value--short-position",t<0)):(i="tv-dome-widget-main__value tv-dome-widget-main__value--price",e&&(i+=" tv-dome-widget-main__value--highlighted"),t>0?i+=" tv-dome-widget-main__value--long-position":t<0&&(i+=" tv-dome-widget-main__value--short-position"),this._priceCell.setAttribute("class",i))}},{key:"setHigherThanBid",value:function(e){this._isHigherThanBestBid=e,this._updateLabelColor(this._orderBuyLabel,this._isActive(e))}},{key:"updateAskLabels",value:function(e){this._isLowerThanBestAsk=e,this._updateLabelColor(this._orderSellLabel,this._isActive(e))}},{key:"handlerKey",value:function(e){var t=(0,o.modifiersFromEvent)(e)===o.Modifiers.Mod;this._orderType=t?r.ORDERTYPE.STOP:r.ORDERTYPE.LIMIT,this._orderSellLabel.textContent=t?a.stopOrder:a.limitOrder,this._orderBuyLabel.textContent=t?a.stopOrder:a.limitOrder,this._updateLabelColor(this._orderBuyLabel,this._isActive(this._isHigherThanBestBid)),this._updateLabelColor(this._orderSellLabel,this._isActive(this._isLowerThanBestAsk))}},{key:"updateIndex",value:function(e){this._index=e}},{key:"updatePrice",value:function(e){this._price=e}},{key:"hideLabels",value:function(){this._orderBuyLabel.style.visibility="hidden",this._orderSellLabel.style.visibility="hidden"}},{key:"updateOrders",value:function(e){for(var t,i,s,n,o,r;this._allocatedOrderViews.length>e.length;)this._ordersPool.free(this._allocatedOrderViews.pop());for(;this._allocatedOrderViews.length<e.length;)this._allocatedOrderViews.push(this._ordersPool.allocate());for(t=!1,i=!1,s=e.length;s-- >0;)n=e[s],o=this._allocatedOrderViews[s],r=!n.noCollapse&&(n.buy?t:i),o.updateOrderData(n.order,n.pricePropertyName),o.updateQty(n.qty),o.updateTypeText(n.typeText),o.updateClassName(n.buy,r,n.type,n.inactive,n.ghost,n.highlighted),n.buy?(this._ordersBuy.appendChild(o.element),t=!0):(this._ordersSell.insertBefore(o.element,this._ordersSell.firstChild),i=!0)}},{key:"destroy",value:function(){var e,t=this._allocatedOrderViews.length;if(t>0){for(e=0;e<t;e++)this._ordersPool.free(this._allocatedOrderViews[e]);this._allocatedOrderViews.length=0}}}]),e}(),d=function(){function e(t,i){s(this,e),this._pool=[],this._handlers=i;var n=t.get(0);n.nodeType===Node.DOCUMENT_NODE?this._document=n:this._document=n.ownerDocument}return n(e,[{key:"allocate",value:function(){return this._pool.length?this._pool.pop():new u(this._document,this._handlers)}},{key:"free",value:function(e){e.destroy(),this._pool.push(e)}}]),e}(),u=function(){function e(t,n){var o,r,a,l,d,u,c=this;s(this,e),(o=t.createElement("div")).setAttribute("class","tv-dome-widget-main__order tv-dome-widget-order"),(r=t.createElement("div")).innerHTML=i("BhuR"),r.setAttribute("class","tv-dome-widget-order__close"),
(a=t.createElement("span")).setAttribute("class","tv-dome-widget-order__qty"),l=t.createTextNode(""),(d=t.createElement("span")).setAttribute("class","tv-dome-widget-order__type"),u=t.createTextNode(""),o.appendChild(r),o.appendChild(a),a.appendChild(l),o.appendChild(d),d.appendChild(u),n&&n.closeButtonClick&&r.addEventListener("click",function(e){n.closeButtonClick.call(null,e,{order:c._order})},!1),n&&n.qtyClick&&a.addEventListener("click",function(e){n.qtyClick.call(null,e,{order:c._order})},!1),n&&n.orderMousedown&&a.addEventListener("mousedown",function(e){n.orderMousedown.call(null,e,{order:c._order,pricePropertyName:c._pricePropertyName})},!1),this.element=o,this._closeButton=r,this._qtyText=l,this._typeText=u}return n(e,[{key:"updateQty",value:function(e){this._qtyText.nodeValue=e||""}},{key:"updateTypeText",value:function(e){this._typeText.nodeValue=e||""}},{key:"updateClassName",value:function(e,t,i,s,n,o){var r=this.element,a="tv-dome-widget-main__order tv-dome-widget-order";t&&(a+=" tv-dome-widget-main__order--collapsed"),e&&(a+=" tv-dome-widget-order--buy"),i&&(a+=" tv-dome-widget-order--type-"+i),s&&(a+=" tv-dome-widget-order--inactive"),n&&(a+=" tv-dome-widget-order--ghost"),o&&(a+=" tv-dome-widget-order--highlighted"),r.setAttribute("class",a)}},{key:"updateOrderData",value:function(e,t){this._order=e,this._pricePropertyName=t}},{key:"destroy",value:function(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this._order=null}}]),e}()},Ft8G:function(e,t,i){},HOHO:function(e,t,i){"use strict";var s,n;i.r(t),i.d(t,"DomDelayedWarning",function(){return n}),i("YFKU"),s={delayedData:window.t("You are seeing delayed data in the DOM. You need to get the data from your broker, if you want to see it real-time.")},n=function(){function e(e){this._warning=document.createElement("span"),this._warning.setAttribute("class","tv-dome-panel__header-warning apply-common-tooltip"),this._warning.setAttribute("title",s.delayedData),this._warning.innerHTML=i("kO76"),e.append(this._warning)}return e.prototype.updateDelayed=function(e){var t,i=this._warning.classList;i?i.toggle("tv-dome-panel__header-warning--active",e):(t="tv-dome-panel__header-warning apply-common-tooltip",e&&(t+=" tv-dome-panel__header-warning--active"),this._warning.setAttribute("class",t))},e}()},HSHW:function(e,t,i){},JnVP:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.pieChartD=function(e){var t="M 0 0";return e>0&&(e>=1?t="M 0 -1":t+="L 0 -1",e>.5&&(t+="A 1 1 0 0 1 0 1"),t+="A 1 1 0 0 1 "+Math.sin(2*e*Math.PI)+" "+-Math.cos(2*e*Math.PI)+"Z"),t}},KFNk:function(e,t,i){},PVgW:function(e,t,i){"use strict";function s(e){return e=Math.abs(e),!Object(d.isInteger)(e)&&e>1&&(e=parseFloat(e.toString().replace(/^.+\./,"0."))),0<e&&e<1?Math.pow(10,null===(s=String(e).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/))?0:(t=s[1]?s[1].length:0,i=s[2]?parseInt(s[2],0):0,Math.max(0,t-i))):1;var t,i,s}function n(e,t){var i,n,o,r,a;e.trigger("tvticker-beforechange"),n=(i=e.data("TVTicker"))&&i.step,o=0,
o=i.parser?i.parser(e.val()):Object(d.isInteger)(n)?parseInt(e.val(),10):parseFloat(e.val()),isNaN(o)&&(o=0),r=s(n),a=t(o,Math.max(r,s(o))),i.formatter&&(a=i.formatter(a)),e.val(a),e.change()}function o(e){var t=e.data("TVTicker"),i=t&&t.step,s=t&&t.max;n(e,function(e,t){var n=(Math.round(e*t)+Math.round(i*t))/t;return void 0!==s&&null!==s&&s<n&&(n=e),n})}function r(e){var t=e.data("TVTicker"),i=t&&t.step,s=t&&t.min;n(e,function(e,t){var n=(Math.round(e*t)-Math.round(i*t))/t;return void 0!==s&&null!==s&&n<s&&(n=e),n})}var a,l,d,u;i.r(t),a=i("P5fv"),l=i("si6p"),d=i("ogJP"),u=i("R4+T"),$.fn.TVTicker=function(e){return void 0===e&&(e={}),this.each(function(){var t,i,s,n=!1,a=$(this),l=a.data("TVTicker");l?n=!0:l={step:Number(a.data("step"))||1},"step"in e&&(l.step=Number(e.step)||l.step),"min"in e&&(l.min=e.min),"max"in e&&(l.max=e.max),"formatter"in e&&(l.formatter=e.formatter),"parser"in e&&(l.parser=e.parser),a.data("TVTicker",l),n||(t=$('<div class="tv-ticker">').appendTo(a.parent()),i=$('<div class="tv-ticker__btn tv-ticker__btn--up">').html(u).appendTo(t),s=$('<div class="tv-ticker__btn tv-ticker__btn--down">').html(u).appendTo(t),t.on("mousedown",function(e){e.preventDefault(),a.focus()}),i.click(function(){a.is(":disabled")||o(a)}),s.click(function(){a.is(":disabled")||r(a)}),a.keydown(function(e){a.is(":disabled")||(38===e.keyCode?i.addClass("i-active"):40===e.keyCode&&s.addClass("i-active"))}),a.keyup(function(e){a.is(":disabled")||(38===e.keyCode?(o(a),i.removeClass("i-active")):40===e.keyCode&&(r(a),s.removeClass("i-active")))}),a.mousewheel(function(e){e.deltaY*(e.deltaFactor/100)>0?i.click():s.click()}))})}},"R4+T":function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 8" width="16" height="8"><path fill="currentColor" d="M0 1.475l7.396 6.04.596.485.593-.49L16 1.39 14.807 0 7.393 6.122 8.58 6.12 1.186.08z"/></svg>'},SScx:function(e,t,i){"use strict";var s,n,o,r,a,l,d,u,c,h;Object.defineProperty(t,"__esModule",{value:!0}),t.DomePanel=void 0,s=function(){function e(e,t){var i,s;for(i=0;i<t.length;i++)(s=t[i]).enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),n=i("OekH"),o=i("tjRS"),r=i("N22A"),i("PC8g"),a=i("HOHO"),l=i("8woN"),d=(h=l)&&h.__esModule?h:{default:h},i("Ft8G"),u=i("hY0g"),c=i("PT1i").linking,t.DomePanel=function(){function e(t){var i,s,a,l,d=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i=42,this.widget=null,this._resizerBridge=t.resizerBridge,this._height=this._resizerBridge.height,this._innerHeight=new u,this._widgetBody=new u,this._height.subscribe(function(e){d._innerHeight.setValue(Math.max(e-i,0))},{callWithLast:!0}),this._visible=new u(!1),this._close=function(){},this.trading=(0,r.tradingService)(),s=function(){var e,t,i=d.trading.activeBroker(),s=void 0;if(i&&i.connectionStatus()===n.CONNECTSTATUSES.CONNECTED&&!i.metainfo().configFlags.supportDOM){
if(e=document.querySelector(".tv-dome-panel__content"),null!==document.querySelector(".tv-dome-panel__disabled")||null==e)return;return t=document.createElement("span"),s=document.createElement("div"),t.classList.add("tv-dome-panel__disabled-warning"),t.innerText=window.t("The DOM window is currently unavailable for this broker"),s.classList.add("tv-dome-panel__disabled"),s.appendChild(t),void e.insertBefore(s,e.firstChild)}(s=document.querySelector(".tv-dome-panel__disabled"))&&s.parentNode&&s.parentNode.removeChild(s)},a=function(e){e?d._body.append(d._container):$(".tv-dome-panel",d._body).detach()},l=function(e){d._delayedWarning.updateDelayed(e)},this.trading.onConnectionStatusChange.subscribe(null,s),this._visible.subscribe(s),s(),this._visible.when(function(){d._resizerBridge.container.subscribe(function(e){d._body=$(".trading-panel-content",e),d._createLayout(),d._updateSymbol(c.proSymbol.value()),c.proSymbol.spawn().subscribe(function(e){d._updateSymbol(e)}),s()},{callWithLast:!0}),d.widget=new o.DomeWidget({body:d._widgetBody,height:d._innerHeight,visible:d._visible}),d._visible.subscribe(a),d.widget.delayedData.subscribe(l)})}return s(e,[{key:"setCloseHandler",value:function(e){this._close=e}},{key:"setVisibility",value:function(e){this._visible.setValue(e)}},{key:"_createLayout",value:function(){var e,t,s=this,n=$("<div>",this._body).addClass("tv-dome-panel");return this._container=n,e=$("<div>",n).addClass("tv-dome-panel__header").append($("<span>",n).addClass("tv-dome-panel__header-close").html(i("uo4K")).on("click",function(e){e.preventDefault(),s._close()})).append($("<span>",n).addClass("tv-dome-panel__header-title").text($.t("DOM"))).append($("<span>",n).addClass("tv-dome-panel__header-symbol")).append($("<span>",n).addClass("tv-dome-panel__header-exchange")).appendTo(n),t=$("<div>",n).addClass("tv-dome-panel__content").appendTo(n),this._delayedWarning=new a.DomDelayedWarning(e),n.on("contextmenu",function(e){$(e.target).is("input, textarea")||e.preventDefault()}),this._body.append(n),this._widgetBody.setValue(t),t}},{key:"_updateSymbol",value:function(e){var t=e&&d.default.shortName(e),i=e&&d.default.getExchange(e);this._container.find(".tv-dome-panel__header-title").text($.t("DOM")+(t||i?": ":"")),this._container.find(".tv-dome-panel__header-symbol").text(t?t+(i?", ":""):""),this._container.find(".tv-dome-panel__header-exchange").text(i||"")}}]),e}()},ZYdM:function(e,t,i){"use strict";var s,n,o,r,a,l;Object.defineProperty(t,"__esModule",{value:!0}),t.DomeCalcBlock=void 0,s=function(){function e(e,t){var i,s;for(i=0;i<t.length;i++)(s=t[i]).enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),i("PVgW"),n=i("OekH"),o=i("zXvd"),r=i("Vdly"),a=function(e){var t,i;if(e&&e.__esModule)return e;if(t={},null!=e)for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(r),l=i("8wgr"),i("4eeX"),i("KFNk"),t.DomeCalcBlock=function(){function e(t){!function(e,t){
if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._handlers=t||{},this._numericFormatter=new o.NumericFormatter,this._nodes={},this._uiState={plViewType:a.getJSON(l.settingsKeys.PROFIT_VIEW_TYPE,0)},this.reset(),this._numFormatter0=new o.NumericFormatter(0),this._numFormatter1=new o.NumericFormatter(1)}return s(e,[{key:"reset",value:function(){this._position=void 0,this._pl=void 0,this._lastPrice=void 0,this._bid=void 0,this._ask=void 0,this._symbolData=null,this.updateQty(1),this._positionInvalidated=!0,this._plInvalidated=!0,this._lastInvalidated=!0,this.scheduleRepaint()}},{key:"setBrokerConfigFlags",value:function(e){var t=e.calculatePLUsingLast;this._calculatePLUsingLast=t}},{key:"setSymbolInfo",value:function(e){var t=this,i=e.minTick,s=e.pipSize,n=e.priceFormatter,o=e.volumeFormatter,r=e.qtyProperties;this._symbolData={minTick:i,pipSize:s,priceFormatter:n,volumeFormatter:o},this._$qty.TVTicker({min:r.min,step:r.step,max:r.max,format:function(e){return t._numericFormatter.format(e)}})}},{key:"updatePosition",value:function(e){this._position=e,this._position||(this._pl=void 0),this._positionInvalidated=!0,this._plInvalidated=!0,this.scheduleRepaint()}},{key:"updatePL",value:function(e){this._pl=e,this._position&&(this._plInvalidated=!0,this.scheduleRepaint())}},{key:"updateLast",value:function(e,t,i){this._lastPrice=e,this._bid=t,this._ask=i,this._position&&0!==this._uiState.plViewType&&(this._plInvalidated=!0,this.scheduleRepaint())}},{key:"updateQty",value:function(e){var t=this._numericFormatter.format(e),i=this._nodes.$qty;i&&i.val()!==t&&(this._suggestedQty=e,i.val(t))}},{key:"getQty",value:function(){var e=parseFloat(this._nodes.$qty.val());return!isFinite(e)||e<0?NaN:e}},{key:"setContainer",value:function(e){var t,i,s,n,o,r,d,u=this;if(this._nodes.$container)for(t in this._nodes.$container.empty(),this._nodes)delete this._nodes[t];delete this._plDirectionCache,delete this._plTextCache,e&&(e.empty().addClass("tv-dome-calc-block").html('<div class="tv-dome-widget-calculator tv-dome-calc-block"><div class="tv-dome-calc-block__wrap"><div class="tv-dome-calc-block__qty-wrap"><input class="tv-dome-calc-block__qty tv-text-input js-qty"></div><span class="tv-dome-calc-block__position js-position"></span><span class="tv-dome-calc-block__pl js-pl"></span></div></div>'),s=(i=e.prop("ownerDocument")).createTextNode(""),n=i.createTextNode(""),o=this._$qty=e.find(".js-qty").val(this._qty||1).addClass("apply-common-tooltip").attr("title",$.t("Quantity")),r=e.find(".js-position").addClass("apply-common-tooltip").attr("title",$.t("Position")).append(n),d=e.find(".js-pl").addClass("apply-common-tooltip").attr("title",$.t("Profit/Loss")).append(s),this._nodes={$container:e,$qty:o,$position:r,$pl:d,plText:s,positionText:n},r.on("click",function(e){e.preventDefault();var t=Math.abs(u._position&&u._position.qty);t>0&&isFinite(t)&&(u.updateQty(t),o.trigger("change"))}),o.on("change",function(e){
u._handlers&&u._handlers.qtyChange&&(o.val(o.val().replace(/[^\d\.]+/g,"")||u._suggestedQty||"1"),u._handlers.qtyChange.call(null,e,{qty:u.getQty()}))}),o.on("keypress",function(e){e.charCode&&/[^\d\.]/.test(String.fromCharCode(e.charCode))&&e.preventDefault()}),this._handlers&&this._handlers.qtyInput&&o.on("input",function(e){u._handlers.qtyInput.call(null,e,{qty:u.getQty()})}),d.on("click",function(e){e.preventDefault(),u._uiState.plViewType=-~u._uiState.plViewType%3,u._plInvalidated=!0,a.setValue(l.settingsKeys.PROFIT_VIEW_TYPE,u._uiState.plViewType),u.scheduleRepaint()}),o.TVTicker({min:1,step:1})),this._positionInvalidated=!0,this._plInvalidated=!0,this.scheduleRepaint()}},{key:"scheduleRepaint",value:function(){var e=this;this._repaintScheduled||(window.requestAnimationFrame?window.requestAnimationFrame(function(){return e.repaint()}):window.setTimeout(function(){return e.repaint()},0),this._repaintScheduled=!0)}},{key:"repaint",value:function(){var e,t,i,s,o,r,a,l,d,u,c,h,_,p,v,m;this._repaintScheduled=!1,(e=this._nodes).$container&&(this._positionInvalidated&&(this._positionInvalidated=!1,0===(t=this._position&&this._position.qty||0)?e.positionText.nodeValue=$.t("Flat"):(i=Math.abs(t),s=void 0,s=this._symbolData&&this._symbolData.volumeFormatter?this._symbolData.volumeFormatter.format(i):i+"",e.positionText.nodeValue=s),o=!!this._position&&-1===this._position.side,r=!!this._position&&1===this._position.side,e.$position.toggleClass("tv-dome-calc-block__position--short",o).toggleClass("tv-dome-calc-block__position--long",r)),this._plInvalidated&&(this._plInvalidated=!1,a=0,l="",d=NaN,this._position&&(u=this._lastPrice,c=this._position.side===n.SIDE.SELL,this._calculatePLUsingLast||(u=c?this._ask:this._bid),a=(d=(u-this._position.avgPrice)*(c?-1:1))<0?-1:1),2===this._uiState.plViewType?(h=NaN,this._position&&(h=d/this._position.avgPrice),l=isFinite(h)?(100*h).toFixed(2)+"%":"%"):1===this._uiState.plViewType?(_=NaN,this._position&&this._symbolData&&(v=(p=this._symbolData).pipSize,m=p.minTick,_=(isFinite(v)&&v!==m?this._numFormatter1:this._numFormatter0).format(d/(v||m))),l=isFinite(_)?$.t("{0} pips").format(_):$.t("Pips")):l=this._position&&isFinite(this._pl)?this._pl.toFixed(2):$.t("P/L"),this._plTextCache!==l&&(e.plText.nodeValue=l,this._plTextCache=l),this._plDirectionCache!==a&&(e.$pl.toggleClass("tv-dome-calc-block__pl--loss",a<0).toggleClass("tv-dome-calc-block__pl--profit",a>0),this._plDirectionCache=a)))}}]),e}()},d7ok:function(e,t,i){},eE7d:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15" width="15" height="15"><path d="M7 1v3h1V1H7zM1 7v1h3V7H1zm10 0v1h3V7h-3zm-4 4v3h1v-3H7zm.5-11a7.5 7.5 0 1 0 0 15 7.5 7.5 0 0 0 0-15zm0 2a5.5 5.5 0 1 1 0 11 5.5 5.5 0 0 1 0-11z"/></svg>'},kO76:function(e,t){
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4 10" width="4" height="10" fill="none"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M2 0C1.21 0 .62.7.75 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 2 0zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/></svg>'},mIGQ:function(e,t,i){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),s=function(){function e(e,t){var i,s;for(i=0;i<t.length;i++)(s=t[i]).enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),t.Timer=function(){function e(t,i,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._delay=t,this._doneCb=i,this._progressCb=s}return s(e,[{key:"run",value:function(){var e,t=this;this._timeoutId||(e=Date.now?Date.now():+new Date,this._expiresAt=e+this._delay,this._timeoutId=window.setTimeout(function(){t.abort(),t._doneCb()},this._delay),this._trackProgressScheduled||this._trackProgress())}},{key:"revert",value:function(){this._timeoutId&&(window.clearTimeout(this._timeoutId),this._timeoutId=void 0,this.run())}},{key:"abort",value:function(){this._timeoutId&&(window.clearTimeout(this._timeoutId),this._timeoutId=void 0,this._expiresAt=void 0,this._progressCb&&this._progressCb(void 0))}},{key:"_trackProgress",value:function(){var e,t,i=this;this._trackProgressScheduled=!1,this._progressCb&&this._timeoutId&&(e=Date.now?Date.now():+new Date,t=1-(this._expiresAt-e)/this._delay,t=Math.max(Math.min(t,1),0),this._progressCb(t),this._wnd&&this._wnd.requestAnimationFrame?this._wnd.requestAnimationFrame(function(){i._trackProgress()}):window.setTimeout(function(){i._trackProgress()},40),this._trackProgressScheduled=!0)}},{key:"setWindow",value:function(e){this._wnd=e}}]),e}()},"pG/X":function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 7" width="12" height="7"><path d="M1 7a1 1 0 0 1-1-1c0-.276.1-.538.28-.72l5-5C5.463.1 5.725 0 6 0c.276 0 .538.1.72.28l5 5c.18.182.28.444.28.72a1 1 0 0 1-1 1c-.276 0-.538-.1-.72-.28L6 2.437l-4.28 4.28C1.537 6.9 1.275 7 1 7z"/></svg>'},tjRS:function(e,t,i){"use strict";(function(e){function s(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,i){return function s(n,o){var r,a;try{a=(r=t[n](o)).value}catch(e){return void i(e)}if(!r.done)return Promise.resolve(a).then(function(e){s("next",e)},function(e){s("throw",e)});e(a)}("next")})}}var n,o,r,a,l,d,u,c,h,_,p,v,m,f,g,y,b,k,w,T,P,C,S;Object.defineProperty(t,"__esModule",{value:!0}),t.DomeWidget=void 0,n=i("14Xm"),o=(S=n)&&S.__esModule?S:{default:S},r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i,s,n=[],o=!0,r=!1,a=void 0;try{for(i=e[Symbol.iterator]();!(o=(s=i.next()).done)&&(n.push(s.value),!t||n.length!==t);o=!0);}catch(e){r=!0,a=e}finally{try{!o&&i.return&&i.return()}finally{if(r)throw a}}return n}(e,t)
;throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=Object.assign||function(e){var t,i,s;for(t=1;t<arguments.length;t++)for(s in i=arguments[t])Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s]);return e},l=function(){function e(e,t){var i,s;for(i=0;i<t.length;i++)(s=t[i]).enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),i("77R2"),d=i("N22A"),u=i("OekH"),c=i("07Ph"),h=i("ZYdM"),_=i("kcTO"),p=i("nEwK"),v=i("JnVP"),m=i("mIGQ"),f=i("9pog"),g=i("Eyy1"),y=i("ei7k"),b=i("7KDR"),k=i("5VQP"),i("7R8i"),i("HSHW"),i("BB8A"),i("d7ok"),w=i("PT1i").linking,T=20,P=2e3,C=3e3,t.DomeWidget=function(){function t(i){var s,n=this,o=i.body,r=i.height,a=i.visible;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.delayedData=new e(!1),this._height=r,this._visible=a,this._symbolData=null,this._supportedOrderTypes=[u.ORDERTYPE.MARKET],this._trading=(0,d.tradingService)(),this._realtimeProvider=this._trading.realtimeProvider(),s=this._handlers(),this._data=new c.DomeData(s,this._trading.showPricesWithZeroVolume.readonly()),this._calcData=new h.DomeCalcBlock(s),this._uiState={},this._timerLockState={},this._timer=new m.Timer(P,function(){n._data.centerOnLast()},function(e){n._updateTimerUi(e)}),this._data.autoCenterRequired.subscribe(function(e){n._mergeTimerLockState({autoCenterRequired:e})}),o.subscribe(function(e){return n._recreateLayout(e)},{callWithLast:!0}),this._height.subscribe(function(){return n._calculateLayout()}),w.proSymbol.subscribe(function(){return n._onStateChange()}),this._realtimeProvider.onStatusChanged.subscribe(null,function(){return n._onStateChange()}),a.subscribe(function(){return n._onStateChange()}),this._onStateChange()}return l(t,[{key:"_recreateLayout",value:function(e){this._$container&&this._$container.off().empty(),this._$container=e,this._createCalculatorBlock(),this._createLegendBlock(),this._createMainBlock(),this._createNavBlock(),this._createActionsBlock(),this._syncActionButtons(),this._calculateLayout()}},{key:"_createMainBlock",value:function(){var e,t,i,s,n=this,o=$("<div>",this._$container).addClass("tv-dome-widget-main");o.appendTo(this._$container),this._$warning=$("<div>",this._$container).addClass("tv-dome-panel__warning i-hidden").text($.t("No data")).appendTo(o),this._data.setContainer(o),e=0,o.on("mousewheel",function(t){if(t.preventDefault(),e+=t.deltaY*t.deltaFactor/100,Math.abs(e)>=1){var i=e%1;n.uiScroll(e-i),e=i}}),t=!1,o.on("touchstart mousedown",function(e){var i,s,r,a,l,d,u;t||((i="mousedown"!==e.type)||1===(e.buttons||e.which))&&(s=n._data.topIndex,isFinite(s)&&(e.touches&&1!==e.touches.length||$(e.target).closest(".tv-dome-widget-main__value--price").eq(0).size()&&(t=!0,a=(r=function(e){return e.originalEvent.touches&&e.originalEvent.touches[0]&&e.originalEvent.touches[0].pageY||e.originalEvent.pageY||0})(e),l=o.parents("html").eq(0),d=function e(){
l.off("mouseup mousedown touchend touchstart touchcancel",e),l.off("mousemove touchmove",u),t=!1,n._data.setDragShield(!1),n._mergeTimerLockState({scroll:!1})},u=function(e){var t,o;i||1===(e.buttons||e.which)?(e.preventDefault(),t=r(e)-a,(o=Math.round(t/T))&&(n._data.setDragShield(!0),n._mergeTimerLockState({scroll:!0})),n._data.shiftTopIndexRelativeToIndex(s,o)):d()},l.on(i?"touchmove":"mousemove",u),l.on(i?"touchend":"mouseup",d),i&&l.on("touchcancel",d),setTimeout(function(){t&&l.on(i?"touchstart":"mousedown",d)},0))))}),o.on("dblclick",function(e){$(e.target).closest(".tv-dome-widget-main__value--price").eq(0).size()&&n.uiCenter()}),this._$mainBlock=o,s=void 0,(s=(i=this._$container.get(0)).nodeType===Node.DOCUMENT_NODE?i:i.ownerDocument).addEventListener("keydown",function(e){return n._data.handlerKey(e)},!1),s.addEventListener("keyup",function(e){return n._data.handlerKey(e)},!1)}},{key:"_createActionsBlock",value:function(){var e=this,t=this._$container,i=(0,y.hotKeySerialize)({keys:["Shift","B"],text:"{0} + {1}"}),s=(0,y.hotKeySerialize)({keys:["Shift","S"],text:"{0} + {1}"}),n=window.t("Set DAY Time In Force for the order"),o=window.t("Set GTC Time In Force for the order"),r=window.t("Cancel all the orders for the current symbol"),a=window.t("Close the position"),l=window.t("Reverse the position")
;this._$actionsBlock=$("<div>",t).addClass("tv-dome-widget-actions").html('<div class="tv-dome-widget-actions__row">\n\t\t\t\t\t<div class="tv-dome-widget-actions__elem tv-button tv-button--primary tv-button--size_small js-buy-mkt apply-common-tooltip" data-tooltip-hotkey="'+i+'">Buy Market</div>\n\t\t\t\t\t<div class="tv-dome-widget-actions__elem tv-button tv-button--danger tv-button--size_small js-sell-mkt apply-common-tooltip" data-tooltip-hotkey="'+s+'">Sell Market</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tv-dome-widget-actions__row">\n\t\t\t\t\t<div class="tv-dome-widget-actions__elem tv-buttons-group tv-buttons-group--primary tv-buttons-group--size-small">\n\t\t\t\t\t\t<div class="tv-dome-widget-actions__button tv-buttons-group__option tv-buttons-group__option--padding_small js-day apply-common-tooltip" title="'+n+'"><span class="tv-buttons-group__option--content apply-overflow-tooltip">DAY</span></div>\n\t\t\t\t\t\t<div class="tv-dome-widget-actions__button tv-buttons-group__option tv-buttons-group__option--padding_small js-gtc apply-common-tooltip" title="'+o+'"><span class="tv-buttons-group__option--content apply-overflow-tooltip">GTC</span></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tv-dome-widget-actions__elem tv-button tv-button--default tv-button--size_small js-flatten apply-common-tooltip" title="'+a+'">Flatten</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tv-dome-widget-actions__row">\n\t\t\t\t\t<div class="tv-dome-widget-actions__elem tv-button tv-button--default tv-button--size_small js-clear apply-common-tooltip" title="'+r+'">CXL All</div>\n\t\t\t\t\t<div class="tv-dome-widget-actions__elem tv-button tv-button--default tv-button--size_small js-reverse apply-common-tooltip" title="'+l+'">Reverse</div>\n\t\t\t\t</div>'),this._actionButtons={$buyMarket:this._$actionsBlock.find(".js-buy-mkt").on("click",function(t){t.preventDefault(),e.uiPlaceOrder({side:u.SIDE.BUY,type:u.ORDERTYPE.MARKET})}),$sellMarket:this._$actionsBlock.find(".js-sell-mkt").on("click",function(t){t.preventDefault(),e.uiPlaceOrder({side:u.SIDE.SELL,type:u.ORDERTYPE.MARKET})}),$day:this._$actionsBlock.find(".js-day").html('<span class="tv-buttons-group__option--content apply-overflow-tooltip">'+$.t("DAY")+"</span>").on("click",function(t){t.preventDefault(),e._uiState.isTradable&&(e._trackEvent("Select DAY"),e._mergeUiState({gtcOrder:!1}))}),$gtc:this._$actionsBlock.find(".js-gtc").html('<span class="tv-buttons-group__option--content apply-overflow-tooltip">'+$.t("GTC")+"</span>").on("click",function(t){t.preventDefault(),e._uiState.isTradable&&(e._trackEvent("Select GTC"),e._mergeUiState({gtcOrder:!0}))}),$flatten:this._$actionsBlock.find(".js-flatten").text($.t("Flatten")).on("click",function(t){t.preventDefault(),e.uiClosePosition()}),$clear:this._$actionsBlock.find(".js-clear").text($.t("CXL All")).on("click",function(t){t.preventDefault(),e.uiCancelAllOrders()}),$reverse:this._$actionsBlock.find(".js-reverse").text($.t("Reverse")).on("click",function(t){t.preventDefault(),e.uiReversePosition()})},
this._$actionsBlock.appendTo(this._$container)}},{key:"_createCalculatorBlock",value:function(){this._$calculatorBlock=$("<div>",this._$container).addClass("tv-dome-widget-actions").appendTo(this._$container),this._calcData.setContainer(this._$calculatorBlock)}},{key:"_createLegendBlock",value:function(){var e=this._$container,t=$("<div>",this._$container).addClass("tv-dome-widget-legend");$("<span>",e).addClass("tv-dome-widget-legend__label tv-dome-widget-legend__label--buy").text($.t("Buy")).appendTo(t),$("<span>",e).addClass("tv-dome-widget-legend__label tv-dome-widget-legend__label--price").text($.t("Price")).appendTo(t),$("<span>",e).addClass("tv-dome-widget-legend__label tv-dome-widget-legend__label--sell").text($.t("Sell")).appendTo(t),this._$legendBlock=t,t.appendTo(this._$container)}},{key:"_createNavBlock",value:function(){var e,t=this,s=this._$container,n=$("<div>",s).addClass("tv-dome-widget-nav").html('<div class="tv-dome-widget-nav__button-block tv-dome-widget-nav__button-block--orders"><span class="tv-dome-widget-nav__button tv-dome-widget-nav__button--clear-ask js-clear-ask">'+i("BhuR")+'</span></div><div class="tv-dome-widget-nav__button-block tv-dome-widget-nav__button-block--buysell"><span class="tv-dome-widget-nav__button tv-dome-widget-nav__button--scroll-up js-scroll-up">'+i("pG/X")+'</span></div><div class="tv-dome-widget-nav__button-block tv-dome-widget-nav__button-block--price"><svg class="tv-dome-widget-nav__timer" viewBox="-1 -1 2 2" width="2" height="2"><path d="M 0,0" class="js-timer-path"></path></svg><span class="tv-dome-widget-nav__button tv-dome-widget-nav__button--center js-center">'+i("eE7d")+'</span></div><div class="tv-dome-widget-nav__button-block tv-dome-widget-nav__button-block--buysell"><span class="tv-dome-widget-nav__button tv-dome-widget-nav__button--scroll-down js-scroll-down">'+i("zIOD")+'</span></div><div class="tv-dome-widget-nav__button-block tv-dome-widget-nav__button-block--orders"><span class="tv-dome-widget-nav__button tv-dome-widget-nav__button--clear-bid js-clear-bid">'+i("BhuR")+"</span></div>");this._$navBlock=n,this._$svgTimerPath=n.find(".js-timer-path"),this._navButtons={$clearBuy:n.find(".js-clear-ask").addClass("apply-common-tooltip").attr("title",$.t("Cancel all buy orders")).on("click",function(e){e.preventDefault(),t.uiCancelAllOrders(u.SIDE.BUY)}),$clearSell:n.find(".js-clear-bid").addClass("apply-common-tooltip").attr("title",$.t("Cancel all sell orders")).on("click",function(e){e.preventDefault(),t.uiCancelAllOrders(u.SIDE.SELL)}),$scrollUp:n.find(".js-scroll-up").addClass("apply-common-tooltip").attr("title",$.t("Scroll up")).on("click",function(e){e.preventDefault(),t.uiScroll(1)}),$scrollDown:n.find(".js-scroll-down").addClass("apply-common-tooltip").attr("title",$.t("Scroll down")).on("click",function(e){e.preventDefault(),t.uiScroll(-1)}),$centerView:n.find(".js-center").addClass("apply-common-tooltip").attr("title",$.t("Center view")).on("click",function(e){e.preventDefault(),t.uiCenter()})},n.appendTo(s),e=n.prop("ownerDocument"),
this._timer.setWindow(e&&e.defaultView)}},{key:"_syncActionButtons",value:function(){var e,t,i,s,n,o,r,a=this._uiState,l=a.isTradable,d=a.hasPosition,c=a.hasBuyOrders,h=a.hasSellOrders,_=a.qty,p=a.gtcOrder;this._actionButtons&&(t="i-active",i="i-disabled",(e=this._actionButtons).$gtc.toggleClass(t,!!this._hasDayGTC&&!!p&&l),e.$day.toggleClass(t,!!this._hasDayGTC&&!p&&l),e.$gtc.toggleClass(i,!this._hasDayGTC||!l),e.$day.toggleClass(i,!this._hasDayGTC||!l),e.$flatten.toggleClass(i,!l||!d||!this._hasFlatten),e.$reverse.toggleClass(i,!l||!d||!this._hasReverse),e.$clear.toggleClass(i,!l||!(c||h)),_&&l?(s=(0,f.abbreviatedNumber)(_),e.$buyMarket.text($.t("Buy {0} Market").format(s)),e.$sellMarket.text($.t("Sell {0} Market").format(s))):(e.$buyMarket.text($.t("Buy Market")),e.$sellMarket.text($.t("Sell Market"))),n=this._isOrderTypeSupported(u.ORDERTYPE.MARKET),e.$buyMarket.toggleClass(i,!n),e.$sellMarket.toggleClass(i,!n)),this._navButtons&&(r="tv-dome-widget-nav__button--disabled",(o=this._navButtons).$clearBuy.toggleClass(r,!l||!c),o.$clearSell.toggleClass(r,!l||!h))}},{key:"_calculateLayout",value:function(){var e,t,i,s,n,o=100,r=this._height.value(),a=!1,l=[{$element:this._$actionsBlock,height:131},{$element:this._$navBlock,height:46},{$element:this._$calculatorBlock,height:49},{$element:this._$legendBlock,height:40}];for(e=0;e<l.length;e++)i=(t=l[e]).$element,s=t.height,a||(r-s<o?a=!0:r-=s),a?i.addClass("js-hidden"):i.css("height",s).removeClass("js-hidden");this._$mainBlock.css("height",r),n=Math.ceil(r/T),this._data.setHeight(n)}},{key:"uiScroll",value:function(e){this._data.shiftTopIndexRelativeToIndex(this._data.topIndex,0|e),this._timer.revert()}},{key:"uiCenter",value:function(){this._data.centerOnLast(),this._trackEvent("Center")}},{key:"uiCancelOrder",value:function(e){this._uiState.isTradable&&((0,g.ensureNotNull)(this._trading.brokerCommandsUI()).cancelOrder(e,!0),this._trackEvent("Cancel Order"))}},{key:"uiModifyOrder",value:function(e,t){var i,s,n=this._realtimeProvider.activeBroker();return!1!==n.metainfo().configFlags.supportModifyOrder&&e&&this._uiState.isTradable?(i=!0,null==t&&(t={},i=!1),s=(0,g.ensureNotNull)(this._trading.brokerCommandsUI()).modifyOrder(a({},e,t),i,void 0,!0),this._lockTimerUntilSettled(s),this._trackEvent("Modify Order"),s):Promise.resolve()}},{key:"uiPlaceOrder",value:function(e){var t,i,s,n=e.side,o=e.price,r=e.altPrice,a=e.type,l=this._realtimeProvider.activeBroker(),d=this;if(l)if(null!==this._subscription.broker){if((a===u.ORDERTYPE.MARKET||isFinite(o))&&(null==a&&(a=this._data.guessOrderType(o,n)),t=!0,null==a&&(t=!1,a=u.ORDERTYPE.LIMIT),this._isOrderTypeSupported(a)))return null!=(i={symbol:w.proSymbol.value(),qty:this._calcData.getQty(),side:n,type:a,duration:this._hasDayGTC?{type:this._uiState.gtcOrder?"GTC":"DAY"}:void 0}).type&&(i.type===u.ORDERTYPE.STOP?i.stopPrice=o:i.type===u.ORDERTYPE.LIMIT?i.limitPrice=o:i.type===u.ORDERTYPE.STOPLIMIT&&(i.stopPrice=o,isFinite(r)?i.limitPrice=r:t=!1)),s=(0,g.ensureNotNull)(this._trading.brokerCommandsUI()).placeOrder(i,t,!0),
this._lockTimerUntilSettled(s),this._trackEvent("Place Order",u.ORDERTYPE[a]),s}else d._trading.toggleTradingWidget();else d._trading.toggleTradingWidget().then(function(){d._trading.onNeedSelectBroker.fire()})}},{key:"uiCancelAllOrders",value:function(e){var t,i=this._uiState;return!i.isTradable||!i.hasBuyOrders&&!i.hasSellOrders||e===u.SIDE.BUY&&!i.hasBuyOrders||e===u.SIDE.SELL&&!i.hasSellOrders?Promise.resolve():(t=(0,g.ensureNotNull)(this._trading.brokerCommandsUI()).cancelOrders(w.proSymbol.value(),e),this._lockTimerUntilSettled(t),e?this._trackEvent("Cancel All "+(1===e?"Buy":"Sell")+" Orders"):this._trackEvent("Cancel All Orders"),t)}},{key:"uiClosePosition",value:function(){var e,t=this;return this._uiState.isTradable&&this._uiState.hasPosition&&this._hasFlatten?(e=this._realtimeProvider.activeBroker().positions(w.proSymbol.value()).then(function(e){var i,s;for(i=0;i<e.length;i++)if(0!==(s=e[i]).qty)return(0,g.ensureNotNull)(t._trading.brokerCommandsUI()).closePosition(s.id,!0)}),this._lockTimerUntilSettled(e),this._trackEvent("Close Position"),e):Promise.resolve()}},{key:"uiReversePosition",value:function(){var e,t=this;return this._uiState.isTradable&&this._uiState.hasPosition&&this._hasReverse?(e=this._realtimeProvider.activeBroker().positions(w.proSymbol.value()).then(function(e){var i,s;for(i=0;i<e.length;i++)if(0!==(s=e[i]).qty)return(0,g.ensureNotNull)(t._trading.brokerCommandsUI()).reversePosition(s.id,!0)}),this._lockTimerUntilSettled(e),this._trackEvent("Reverse"),e):Promise.resolve()}},{key:"uiOrderMousedown",value:function(e,t,i){var s,n,o,r,a,l,d,u=this;1===(e.buttons||e.which)&&(s=t[i],n=this._data.priceToIndex(t[i]),isFinite(n)&&(this.uiStopOrderDrag(),r=(o=function(e){return e.touches&&e.touches[0]&&e.touches[0].pageY||e.pageY||0})(e),a=NaN,l=!1,(d=this._subscription).$orderMouseRoot=this._$mainBlock.parents("html").eq(0),d.orderMousemoveHandler=function(e){var d,c,h;e.preventDefault(),1===(e.buttons||e.which)?(d=0,$(e.target).closest(u._$mainBlock).size()&&(d=r-o(e)),0===(c=Math.round(d/T))?a=s:(h=u._data.correctIndex(n,c),a=u._data.indexToPrice(h),l=!0,u._data.setDragShield(!0),u._mergeTimerLockState({drag:!0})),l&&u._data.setOrderGhost({order:t,pricePropertyName:i,price:a})):u.uiStopOrderDrag()},d.orderMouseupHandler=function(e){var n,o,r;(u.uiStopOrderDrag(),u._realtimeProvider.activeBroker()&&isFinite(a)&&a!==s)&&(u._data.setOrderGhost({order:t,pricePropertyName:i,price:a}),u._data.setDragShield(!0),u._trackEvent("Move Order"),u.uiModifyOrder(t,(n={},o=i,r=a,o in n?Object.defineProperty(n,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[o]=r,n)).then(function(){return u.uiStopOrderDrag()}).catch(function(){return u.uiStopOrderDrag()}))},d.orderMousedownHandler=function(e){u.uiStopOrderDrag()},d.$orderMouseRoot.on("mousemove",d.orderMousemoveHandler),d.$orderMouseRoot.on("mouseup",d.orderMouseupHandler),setTimeout(function(){d.$orderMouseRoot.on("mousedown",d.orderMousedownHandler)},0)))}},{key:"uiStopOrderDrag",value:function(){if(this._data.setDragShield(!1),
this._data.resetOrderGhost(),this._mergeTimerLockState({drag:!1}),this._subscription){var e=this._subscription,t=e.orderMousemoveHandler,i=e.orderMouseupHandler,s=e.orderMousedownHandler,n=e.$orderMouseRoot;delete this._subscription.orderMousemoveHandler,delete this._subscription.orderMouseupHandler,delete this._subscription.orderMousedownHandler,delete this._subscription.$orderMouseRoot,n&&t&&n.off("mousemove",t),n&&i&&n.off("mouseup",i),n&&s&&n.off("mousedown",s)}}},{key:"uiContextMenu",value:function(e,t,i){var s,n,o,r,a,l,d,c,h,p,v,m,g,y,T,P,C,S,x=this;this._uiState.isTradable&&(t!==u.SIDE.BUY&&t!==u.SIDE.SELL||(s=w.seriesShortSymbol.value()||w.proSymbol.value(),n=(0,f.abbreviatedNumber)(this._uiState.qty),o=[],r=this._symbolData&&this._symbolData.priceFormatter||new _.PriceFormatter,this._trackEvent("Context Menu"),isFinite(i)&&(a=r.format(i),this._isOrderTypeSupported(u.ORDERTYPE.STOP)&&(l={stopPrice:a,qty:n,symbol:s},d="",d=t===u.SIDE.BUY?$.t("Buy __qty__ __symbol__ @ __stopPrice__ Stop",l):$.t("Sell __qty__ __symbol__ @ __stopPrice__ Stop",l),c=new b.Action({label:d,onExecute:function(){x.uiPlaceOrder({side:t,price:i,type:u.ORDERTYPE.STOP})}}),o.push(c)),this._isOrderTypeSupported(u.ORDERTYPE.LIMIT)&&(h={limitPrice:a,qty:n,symbol:s},p="",p=t===u.SIDE.BUY?$.t("Buy __qty__ __symbol__ @ __limitPrice__ Limit",h):$.t("Sell __qty__ __symbol__ @ __limitPrice__ Limit",h),v=new b.Action({label:p,onExecute:function(){x.uiPlaceOrder({side:t,price:i,type:u.ORDERTYPE.LIMIT})}}),o.push(v)),this._symbolData&&this._hasStopLimit&&(m=i+this._symbolData.minTick*(t===u.SIDE.BUY?1:-1),g={stopPrice:a,limitPrice:r.format(m),qty:n,symbol:s},y="",y=t===u.SIDE.BUY?$.t("Buy __qty__ __symbol__ @ __stopPrice__ Stop __limitPrice__ Limit",g):$.t("Sell __qty__ __symbol__ @ __stopPrice__ Stop __limitPrice__ Limit",g),T=new b.Action({label:y,onExecute:function(){x.uiPlaceOrder({side:t,price:i,altPrice:m,type:u.ORDERTYPE.STOPLIMIT})}}),o.push(T))),this._isOrderTypeSupported(u.ORDERTYPE.MARKET)&&(P={qty:n,symbol:s},C="",C=t===u.SIDE.BUY?$.t("Buy __qty__ __symbol__ @ Market",P):$.t("Sell __qty__ __symbol__ @ Market",P),S=new b.Action({label:C,onExecute:function(){x.uiPlaceOrder({side:t,type:u.ORDERTYPE.MARKET})}}),o.push(S)),o.length&&k.ContextMenuManager.createMenu(o).then(function(t){t.show(e)})))}},{key:"_mergeUiState",value:function(e){var t,i=this._uiState,s=!1;for(t in e)i!==e[t]&&(i[t]=e[t],s=!0);s&&this._syncActionButtons()}},{key:"_handlers",value:function(){var e=this;return{closeButtonClick:function(t,i){var s=i.order;t.preventDefault(),e.uiCancelOrder(s&&s.id)},qtyClick:function(t,i){var s=i.order;t.preventDefault(),e.uiModifyOrder(s)},bidAskClick:function(t,i){var s=i.side,n=i.price,o=i.type;t.preventDefault(),e.uiPlaceOrder({side:s,price:n,type:o})},bidAskContextMenu:function(t,i){var s=i.side,n=i.price;t.preventDefault(),e.uiContextMenu(t,s,n)},qtyChange:function(t,i){var s=i.qty;!isFinite(s)||s<0||e._trading.suggestedQty().setValue(w.proSymbol.value(),s)},qtyInput:function(t,i){var s=i.qty;!isFinite(s)||s<0||e._mergeUiState({
qty:s})},orderMousedown:function(t,i){var s=i.order,n=i.pricePropertyName;e.uiOrderMousedown(t,s,n)}}}},{key:"_mergeTimerLockState",value:function(e){var t,i=this._timerLockState,s=!1;for(t in e)i[t]!==e[t]&&(i[t]=e[t],s=!0);s&&(!i.autoCenterRequired||i.scroll||i.drag||i.dialog?this._timer.abort():this._timer.run())}},{key:"_lockTimerUntilSettled",value:function(e){var t,i=this;if(e)return this._mergeTimerLockState({dialog:e}),t=function(){i._timerLockState.dialog===e&&i._mergeTimerLockState({dialog:null})},e.then(t,t)}},{key:"_updateTimerUi",value:function(e){e=e||0,this._$svgTimerPath.attr("d",(0,v.pieChartD)(e))}},{key:"_getSymbolData",value:function(){var e=s(o.default.mark(function e(t,i){var s,n,a,l,d,u;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this._realtimeProvider.symbolInfo(i),this._realtimeProvider.formatter(i),this._realtimeProvider.quantityFormatter(i)]);case 2:return s=e.sent,n=r(s,3),a=n[0],l=n[1],d=n[2],u=void 0!==a.domVolumePrecision?new p.VolumeFormatter(a.domVolumePrecision):new p.VolumeFormatter,e.abrupt("return",{minTick:a.minTick,pipSize:a.pipSize,priceFormatter:l,volumeFormatter:u,quantityFormatter:d,qtyProperties:a.qty});case 9:case"end":return e.stop()}},e,this)}));return function(t,i){return e.apply(this,arguments)}}()},{key:"_unsubscribeData",value:function(){if(this._subscription){var e=this._subscription,t=e.broker,i=e.symbol,s=e.domeHandler,n=e.realtimeHandler,o=e.orderHandler,r=e.positionHandler,a=e.plHandler,l=e.plPositionId,d=e.suggestedQtyHandler,u=e.fullUpdateOrders,c=e.fullUpdatePosition;this._subscription=null,i&&n&&this._realtimeProvider.unsubscribeRealtime(i,n),i&&s&&this._realtimeProvider.unsubscribeDOME(i,s),t&&o&&t.orderUpdate.unsubscribe(null,o),t&&r&&t.positionUpdate.unsubscribe(null,r),t&&a&&l&&t.unsubscribePL(l,a),d&&this._trading.suggestedQty().changed.unsubscribe(null,d),t&&u&&t.fullUpdate.unsubscribe(u),t&&c&&t.fullUpdate.unsubscribe(c)}}},{key:"_trackEvent",value:function(e,t){this._trading.trackEvent("DOM",e,t)}},{key:"_processOrders",value:function(e){var t,i,s=[],n=!1,o=!1;for(t=0;t<e.length;t++)if((i=e[t]).status===u.ORDERSTATUS.PLACING||i.status===u.ORDERSTATUS.INACTIVE||i.status===u.ORDERSTATUS.WORKING)switch(s.push(i),i.side){case u.SIDE.BUY:n=!0;break;case u.SIDE.SELL:o=!0}this._data.updateOrders(s),this._mergeUiState({hasBuyOrders:n,hasSellOrders:o})}},{key:"_processPositions",value:function(e,t,i){var s=this,n=i.filter(function(e){return 0!==e.qty})[0];this._mergeUiState({hasPosition:!!n}),n&&n.id===t.plPositionId||t.plPositionId&&t.plHandler&&(e.unsubscribePL(t.plPositionId,t.plHandler),delete t.plPositionId,delete t.plHandler),n&&(t.plPositionId===n.id&&t.plHandler||(t.plHandler=function(e,i){s._subscription===t&&s._calcData.updatePL(i)},t.plPositionId=n.id,e.subscribePL(t.plPositionId,t.plHandler))),this._data.updatePosition(n),this._calcData.updatePosition(n)}},{key:"_onStateChange",value:function(){var e=s(o.default.mark(function e(){var t,i,s,n,r,a,l,d,u,c=this;return o.default.wrap(function(e){
for(;;)switch(e.prev=e.next){case 0:if(this._visible.value()){e.next=3;break}return this._unsubscribeData(),e.abrupt("return");case 3:if(t=w.proSymbol.value(),i=this._realtimeProvider.activeBroker(),this._noDataTimeout&&clearTimeout(this._noDataTimeout),this._noDataTimeout=setTimeout(function(){return c._$warning.toggleClass("i-hidden",!1)},C),this._symbolData=null,this._unsubscribeData(),this._data.reset(),this._calcData.setBrokerConfigFlags({calculatePLUsingLast:i&&i.metainfo().configFlags.calculatePLUsingLast}),this._calcData.reset(),s=i&&i.metainfo().durations,n=null===i||i.metainfo().configFlags.supportDOM,this._hasDayGTC=!!(s&&s.find(function(e){return"DAY"===e.value})&&s.find(function(e){return"GTC"===e.value})),this._hasReverse=i&&i.metainfo().configFlags.supportReversePosition,this._hasFlatten=i&&!i.metainfo().configFlags.supportMultiposition,this._hasStopLimit=i&&i.metainfo().configFlags.supportStopLimitOrders,this._mergeUiState({isTradable:!1,hasPosition:!1,hasBuyOrders:!1,hasSellOrders:!1,qty:void 0}),this._mergeTimerLockState({scroll:!1,drag:!1,dialog:null}),this.uiStopOrderDrag(),r=[],a=[],t&&n){e.next=25;break}return e.abrupt("return");case 25:return l={broker:i,symbol:t,domeHandler:null,realtimeHandler:null,orderHandler:null,positionHandler:null,plHandler:null,plPositionId:void 0,suggestedQtyHandler:null,fullUpdateOrders:null,fullUpdatePosition:null},this._subscription=l,l.suggestedQtyHandler=function(){c._trading.suggestedQty().value(t).then(function(e){c._subscription===l&&(c._calcData.updateQty(e),c._mergeUiState({qty:e}))})},this._trading.suggestedQty().changed.subscribe(null,l.suggestedQtyHandler),l.suggestedQtyHandler(),e.next=32,this._getSymbolData(i,t);case 32:if(d=e.sent){e.next=35;break}return e.abrupt("return");case 35:if(this._subscription===l){e.next=37;break}return e.abrupt("return");case 37:return this._symbolData=d,this._data.setSymbolInfo(d),this._calcData.setSymbolInfo(d),l.realtimeHandler=function(e,t){var i=t.trade||t.bid||t.ask;i&&c._noDataTimeout&&(c._$warning.toggleClass("i-hidden",!0),clearTimeout(c._noDataTimeout),c._noDataTimeout=null),c._data.updateLast(i),c._calcData.updateLast(t.trade,t.bid,t.ask),c.delayedData.setValue(Boolean(t.isDelayed))},l.domeHandler=function(e,t){c._data.updateData(t)},e.next=44,this._realtimeProvider.isTradable(t);case 44:u=e.sent.tradable,this._mergeUiState({isTradable:u}),this._realtimeProvider.subscribeRealtime(t,l.realtimeHandler),this._realtimeProvider.subscribeDOME(t,l.domeHandler),this._supportedOrderTypes=this._getSupportedOrderTypes(i),i&&u&&(l.orderHandler=function(e){if(e.symbol===l.symbol){var t=r.findIndex(function(t){return t.id===e.id});-1!==t?r[t]=e:r.push(e),c._processOrders(r)}},l.positionHandler=function(e){if(e.symbol===l.symbol){var t=a.findIndex(function(t){return t.id===e.id});-1!==t?a[t]=e:a.push(e),c._processPositions(i,l,a)}},l.fullUpdateOrders=function(){var e=i.orders(t);l.orderPromise=e,e.then(function(t){c._subscription===l&&l.orderPromise===e&&(r=t,c._processOrders(t))})},l.fullUpdatePosition=function(){
var e=i.positions(t);l.positionPromise=e,e.then(function(t){c._subscription===l&&l.positionPromise===e&&(a=t,c._processPositions(i,l,t))})},i.orderUpdate.subscribe(null,l.orderHandler),i.positionUpdate.subscribe(null,l.positionHandler),i.fullUpdate.subscribe(null,l.fullUpdateOrders),i.fullUpdate.subscribe(null,l.fullUpdatePosition),l.fullUpdateOrders(),l.fullUpdatePosition());case 50:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_getSupportedOrderTypes",value:function(e){var t=[];return null===e||e.connectionStatus()!==u.CONNECTSTATUSES.CONNECTED?[u.ORDERTYPE.MARKET]:(e.metainfo().configFlags.supportMarketOrders&&t.push(u.ORDERTYPE.MARKET),e.metainfo().configFlags.supportLimitOrders&&t.push(u.ORDERTYPE.LIMIT),e.metainfo().configFlags.supportStopOrders&&t.push(u.ORDERTYPE.STOP),e.metainfo().configFlags.supportStopLimitOrders&&t.push(u.ORDERTYPE.STOPLIMIT),t)}},{key:"_isOrderTypeSupported",value:function(e){return-1!==this._supportedOrderTypes.indexOf(e)}}]),t}()}).call(this,i("hY0g"))},"y1L/":function(e,t,i){},zIOD:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 7" width="12" height="7"><path d="M1 0a1 1 0 0 0-1 1c0 .276.1.538.28.72l5 5c.182.18.444.28.72.28.276 0 .538-.1.72-.28l5-5c.18-.182.28-.444.28-.72a1 1 0 0 0-1-1c-.276 0-.538.1-.72.28L6 4.563 1.72.282C1.537.1 1.275 0 1 0z"/></svg>'}}]);