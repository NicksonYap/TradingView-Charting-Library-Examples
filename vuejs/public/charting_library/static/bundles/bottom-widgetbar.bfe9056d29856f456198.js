(window.webpackJsonp=window.webpackJsonp||[]).push([["bottom-widgetbar"],{"3A7E":function(e,t,i){},Vg5g:function(e,t,i){"use strict";var o,n,a,s,r,d,c,h,u;i.r(t),i.d(t,"Bottomwidgetbar",function(){return u}),o=i("P5fv"),n=i("hY0g"),a=i.n(n),s=i("Vdly"),r=i("dwZ6"),d=i("ZzsE"),c=i("3A7E"),h=i("i8AX"),u=function(){function e(e,t){var i=this;this._inited=!1,this._minHeight=30,this._paddingTop=r.a,this.open=function(){"minimized"===i._mode.value()&&i._mode.setValue("normal")},this.close=function(){i._mode.setValue("minimized")},this.toggleMaximize=function(){switch(i._mode.value()){case"minimized":case"normal":i._mode.setValue("maximized");break;case"maximized":i._mode.setValue("normal")}},this.toggleMinimize=function(){switch(i._mode.value()){case"minimized":i.open();break;case"normal":case"maximized":i.close()}},this._mode=new a.a,this._isOverlap=new a.a,this._activeWidget=new a.a,this._widgets={},this._buttons={},this._widgetsProperties={},this._normalHeight=new a.a,this._actualHeight=new a.a,this._userSettings=t,this._options=e||{},this._config=e.config,this._enabledWidgets=(e&&e.widgets||[]).filter(function(e){return e&&Boolean(i._config[e])}),this._init(e)}return e.prototype.activeWidget=function(){return this._activeWidget.readonly()},e.prototype.footerWidgetContainer=function(){return this._$footerWidgetContainer[0]},e.prototype.toggleWidget=function(e,t){var i=this;return new Promise(function(o){"boolean"==typeof e?e?i.open():i.close():i.isWidgetEnabled(e)&&(t?i.open():i.activeWidget().value()===e?"minimized"===i.mode().value()?i.open():i.close():i.open(),i._activeWidget.setValue(e)),o()})},e.prototype.getWidgetByName=function(e){return this._widgets[e]||null},e.prototype.getButtonByName=function(e){return this._buttons[e]||null},e.prototype.mode=function(){return this._mode.readonly()},e.prototype.isOverlap=function(){return this._isOverlap.readonly()},e.prototype.setNormalHeight=function(e){this._normalHeight.setValue(e)},e.prototype.destroy=function(){},e.prototype.isWidgetEnabled=function(e){return this._enabledWidgets.includes(e)},e.prototype.activateTradingTab=function(){var e=this;return this.toggleWidget("paper_trading",!0).then(function(){var t=e.getWidgetByName("paper_trading");t&&t.activate&&t.activate()})},e.prototype.activateScriptEditorTab=function(e){var t=this;this.toggleWidget("screener",!0).then(function(){var i=t._config.scripteditor;i&&i.ctor.open(e)})},e.prototype.turnOffMaximize=function(){"maximized"===this._mode.value()&&this.toggleMaximize()},e.prototype.enabledWidgets=function(){var e=this;return this._enabledWidgets.map(function(t){return e._config[t]})},e.prototype.activeWidgetName=function(){return this._activeWidget.value()},e.prototype._init=function(e){var t,i,o=this;this._enabledWidgets.length&&!this._inited&&(this._createLayout($(this._options.resizerBridge.container.value())),t=function(){var e,t=0;switch(o._mode.value()){case"normal":t=o._normalHeight.value();break;case"maximized":t=o._resizerAvailHeight()}e={
min:Math.min(o._getPaddingBoxHeight(t),o._getPaddingBoxHeight(o._minHeight)),max:o._getPaddingBoxHeight(t)},o._options.resizerBridge.negotiateHeight(e)},i=function(){var i,n,s,r,d,c,h;"minimized"!==o._mode.value()&&(i=o._activeWidget.value(),n=void 0,o._$container.removeClass("js-hidden").css({height:o._actualHeight.value()}),o._$container.find(".bottom-widgetbar-content").addClass("js-hidden"),o._widgets[i]?(h=o._widgets[i])&&h._$content&&(n=h._$content).removeClass("js-hidden"):((n=$(document.createElement("div")).attr("class","bottom-widgetbar-content "+i)).appendTo(o._$container),o._initWidgetProperties(i),s=new a.a,o._activeWidget.subscribe(function(e){s.setValue(e===i)},{callWithLast:!0}),r=function(){o.toggleWidget(i,!0)},(d=o._config[i])&&(c=d.ctor,o._widgets[i]=new c({$body:n,container:n[0],height:o._actualHeight,width:o._options.resizerBridge.width,bottomToolbarMode:o.mode(),visible:s.readonly(),properties:o._widgetsProperties[i],activate:r,chartWidgetCollection:e.chartWidgetCollection||null,originalStandalone:"screener"===i,backtestingStrategyDispatcher:o._options.backtestingStrategyDispatcher})),(h=o._widgets[i])&&(h._$content=n,h.disabled&&h.disabled.subscribe(function(e){o._$loadingOverlay.toggleClass("js-hidden",!e)})))),o._normalHeight.unsubscribe(t),o._normalHeight.subscribe(t),o._mode.unsubscribe(t),o._mode.subscribe(t),o._options.resizerBridge.availHeight.unsubscribe(t),o._options.resizerBridge.availHeight.subscribe(t),t(),o._save()},this._mode.subscribe(i),this._activeWidget.subscribe(i),this._normalHeight.subscribe(function(){o._save()}),this._mode.subscribe(function(){o._save()}),this._options.resizerBridge.height.subscribe(function(){var e=o._options.resizerBridge.height.value(),t=Math.max(o._getContentBoxHeight(e),0);o._$container.css("height",t),o._actualHeight.setValue(t)},{callWithLast:!0}),this._registerWidgets(),this._loadState(),this._subscribeCheckOverlap(),this._inited=!0)},e.prototype._getContentBoxHeight=function(e){return e-this._paddingTop},e.prototype._getPaddingBoxHeight=function(e){return e+this._paddingTop},e.prototype._subscribeCheckOverlap=function(){var e=this;this._checkOverlap(),this._actualHeight.subscribe(function(){e._checkOverlap()}),this._mode.subscribe(function(){e._checkOverlap()}),this._options.resizerBridge.availHeight.subscribe(function(){e._checkOverlap()})},e.prototype._createLayout=function(e){e[0].innerHTML="",this._$footerWidgetContainer=$("<div>").css({height:r.a}).appendTo(e),this._$container=$("<div>").attr("id","bottom-area").appendTo(e),$(document.createElement("div")).attr("class","bottom-widgetbar-handle").appendTo(this._$container).on("contextmenu",function(e){e.preventDefault()}).on("mousedown touchstart",this._onLayoutResizeHandleMousedown.bind(this)),this._$loadingOverlay=$(document.createElement("div")).attr("class","bottom-widgetbar-loading-overlay js-hidden").appendTo(this._$container)},e.prototype._onLayoutResizeHandleMousedown=function(e){var t,i,o,n,a,s,r=this;e.defaultPrevented||(e.preventDefault(),t=this._mode.value(),
i=this._normalHeight.value(),o="minimized"===this._mode.value()?0:this._$container.height(),n=e.originalEvent.touches?e.originalEvent.touches[0].clientY:e.pageY,a=function(e){var t,i,a;t=(e.originalEvent.touches?e.originalEvent.touches[0].clientY:e.pageY)-n,i="minimized"===r._mode.value(),(a=o-t)<=0?(a=o,i=!0):i=!1,a=Math.max(a,r._minHeight),isFinite(a)&&("minimized"===r._mode.value()!==i?i?(r._mode.setValue("minimized"),r.setNormalHeight(Math.max(o,r._minHeight))):(r._mode.setValue("normal"),r.setNormalHeight(a)):r._normalHeight.value()!==a&&(a>=r._getContentBoxHeight(r._resizerAvailHeight())?(r._mode.setValue("maximized"),r.setNormalHeight(o)):(r._mode.setValue("normal"),r.setNormalHeight(a))))},s=function(){i>0&&"normal"!==r._mode.value()&&"normal"!==t&&r.setNormalHeight(i),$(document.documentElement).off("mousemove touchmove",a).off("mouseup touchend",s),r._save()},$(document.documentElement).on("mousemove touchmove",a).on("mouseup touchend",s))},e.prototype._checkOverlap=function(){var e=this._getPaddingBoxHeight(this._actualHeight.value()),t=this._mode.value();this._isOverlap.setValue("maximized"===t||"normal"===t&&this._resizerAvailHeight()-e<=300)},e.prototype._resizerAvailHeight=function(){return this._options.resizerBridge.availHeight.value()},e.prototype._initWidgetProperties=function(e){var t="bottom"+e+"widget",i=new a.a(s.getJSON(t,null));i.subscribe(function(e){e?s.setJSON(t,e):s.remove(t)}),this._widgetsProperties[e]=i},e.prototype._loadState=function(){var e=this._userSettings;this._mode.setValue(e.mode),this._activeWidget.setValue(this.isWidgetEnabled(e.activeWidget)?e.activeWidget:this._enabledWidgets[0]),this.setNormalHeight(Math.max(e.height,this._minHeight))},e.prototype._save=function(){this._inited&&Object(d.c)({activeWidget:this._activeWidget.value(),height:this._normalHeight.value(),mode:this._mode.value()})},e.prototype._registerWidgets=function(){var e=this;this._enabledWidgets.forEach(function(t){var i,o=e._config[t];o&&"function"==typeof o.onRegister&&(i=function(){e.toggleWidget(t,!0)},o.onRegister.call(null,{activate:i,name:t}))})},e}()},i8AX:function(e,t,i){}}]);